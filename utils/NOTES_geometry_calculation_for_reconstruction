emClarity typically creates a bin10 reconstruction with thickness 300, so 3000 in unbinned space...

geometry is calculated in recScript2.sh

basename = $1 i.e. recScript2.sh basename

from emC tutorial basename is tilt${iTilt}

e.g. basename = tilt5

modfile = bin10/tilt5_bin10.mod
modbin = 10
modThick = 300

wrkDir = pwd

sizeSt = header -size aliStacks/tilt5_ali1.fixed

if fixedStacks/tilt5.local exists
do some stuff

above may be important for exact particle positions...

model2point -float -contour bin10/tilt5_bin10.mod mod.tmp
model is defined as
xmin
xmax
ymin
ymax
zmin
zmax

taken from 6 xyz positions defined in that order (i.e only takes one coordinate from each line)

-contour outputs contour numbers starting from 1
model file must have one contour per point
sort -k 1 -g mod.tmp > tilt5_bin10.mod.txt

sorts mod.tmp based on first column, -g is general numeric sort
i.e produces sorted list of points by contour number

checks that there was a multiple of 6 lines, how many subareas to be reconstructed

makes recon folder

makes file called recon/tilt5_recon.coords
adds basename of tilt series to recon/tilt5_recon.coords on first line
adds number of subareas to recon/tilt5_recon.coords on next line


e.g. 2 subareas
for each subarea in 1 2
TiltName (string, basename for the tilt series as you would enter for "ctf estimate"

nSubRegions (integer, total number of tomograms in the tilt-series)

simple int(xmax - xmin) | tomo1-NX (integer, WIDTH of this tomogram) 

y min| tomo1-NY1 (integer, SLICE float 1 -- starting Y)

y max | tomo1-NY2 (integer, SLICE float 2 -- ending Y)

zmax - zmin | tomo1-NZ (integer, THICKNESS)

-1*xmin | tomo1-CX (float, SHIFT 1 -- (-1)*position of tomogram origin in X, i.e. shift needed to center the recon area in the output)

tomo1-CZ (float, SHIFT 2 -- Z offset. Note this is already implicitly multiplied by -1 due to the rotated reference frame that IMOD uses to speed up reconstruction)


format of tilt command then becomes
  echo '#!/bin/bash'
  echo ''
  echo "tilt -input ${wrkDir}/ctfStacks/${baseName}_ali1_ctf.fixed \\"
  echo "     -TILTFILE ${wrkDir}/fixedStacks/${baseName}.tlt \\"
  echo "     -output ${wrkDir}/recon/${baseName}_${iPart}.rec \\"
  echo "     -RADIAL 0.475,0.05 \\"
  echo "     -UseGPU 0 \\"
  echo "     -WIDTH $WIDTH \\"
  echo "     -SLICE $yLow,$yTop \\"
  echo "     -THICKNESS $THICKNESS \\"
  echo "     -RotateBy90 \\"
  if [[ ${localFILE} ]] ; then
  echo "     ${localFILE}"
  fi
  echo "     -SHIFT $oX,$oZ"



